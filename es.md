http://localhost:9200/?pretty


http://localhost:9200/_count?pretty

{code}
{
	"count": 0,
	"_shards": {
		"total": 0,
		"successful": 0,
		"failed": 0
	}
}
{code}


index = database

every field in a document is indexed (has an inverted index) and is searchable

curl -XPUT 'localhost:9200/megacorp/employee/1?pretty' -d'
{
    "first_name" : "John",
    "last_name" :  "Smith",
    "age" :        25,
    "about" :      "I love to go rock climbing",
    "interests": [ "sports", "music" ]
}'

index = megacorp
type = employee


curl -XGET 'localhost:9200/megacorp/employee/1?pretty'

# returns top 10 results by default
curl -XGET 'localhost:9200/megacorp/employee/_search?pretty'

curl -XGET 'localhost:9200/megacorp/employee/_search?q=last_name:Smith&pretty'

# query DSL
curl -XGET 'localhost:9200/megacorp/employee/_search?pretty' -d'
{
    "query" : {
        "match" : {
            "last_name" : "Smith"
        }
    }
}'


curl -XGET 'localhost:9200/megacorp/employee/_search?pretty' -d'
{
    "query" : {
        "bool" : {
            "must" : {
                "match" : {
                    "last_name" : "smith" 
                }
            },
            "filter" : {
                "range" : {
                    "age" : { "gt" : 30 } 
                }
            }
        }
    }
}'

# full text search

curl -XGET 'localhost:9200/megacorp/employee/_search?pretty' -d'
{
    "query" : {
        "match" : {
            "about" : "rock climbing"
        }
    }
}'


	# exact match
	curl -XGET 'localhost:9200/megacorp/employee/_search?pretty' -d'
	{
	    "query" : {
	        "match_phrase" : {
	            "about" : "rock climbing"
	        }
	    }
	}'


	# highlighted
	curl -XGET 'localhost:9200/megacorp/employee/_search?pretty' -d'
	{
	    "query" : {
	        "match_phrase" : {
	            "about" : "rock climbing"
	        }
	    },
	    "highlight": {
	        "fields" : {
	            "about" : {}
	        }
	    }
	}'


# analytics	
curl -XGET 'localhost:9200/megacorp/employee/_search?pretty' -d'
{
  "aggs": {
    "all_interests": {
      "terms": { "field": "interests" }
    }
  }
}'

	# aggregates
	curl -XGET 'localhost:9200/megacorp/employee/_search?pretty' -d'
	{
	    "aggs" : {
	        "all_interests" : {
	            "terms" : { "field" : "interests" },
	            "aggs" : {
	                "avg_age" : {
	                    "avg" : { "field" : "age" }
	                }
	            }
	        }
	    }
	}'


# documents
It refers to the top-level, or root object that is serialized into JSON and stored in Elasticsearch under a unique ID.
Object is referring to a JSON object.

# document meta data
	_index 
		.e.g products_index
		internally indexes are broken into shards
	_type
		e.g. electronics, kitchen, lawn-care (inside of products_index)
	_id
		provide your own id or let ES generate one
		autogenerated IDs are 20 character long, URL-safe, Base64-encoded GUID strings.


# indexing a document
PUT /{index}/{type}/{id}
{
	"field" : "value", ...
}

	PUT /website/blog/123
	{
	  "title": "My first blog entry",
	  "text":  "Just trying this out...",
	  "date":  "2014/01/01"
	}

	# response includes incrementing version (used for conflicts)
	{
	   "_index":    "website",
	   "_type":     "blog",
	   "_id":       "123",
	   "_version":  1,
	   "created":   true
	}

# retrieving a document
curl -XGET 'localhost:9200/website/blog/123?pretty&pretty'

	{
	  "_index" :   "website",
	  "_type" :    "blog",
	  "_id" :      "123",
	  "_version" : 1,
	  "found" :    true,
	  "_source" :  {
	      "title": "My first blog entry",
	      "text":  "Just trying this out...",
	      "date":  "2014/01/01"
	  }
	}

	# partial doc
	curl -XGET 'localhost:9200/website/blog/123?_source=title,text&pretty'
	source only has title and text

	# no meta data
	curl -XGET 'localhost:9200/website/blog/123/_source?pretty'

	# doc exists?
	curl -i -XHEAD http://localhost:9200/website/blog/123

# updating a Doc
documents in ES are immutable
update by either reindex or replacing it

	curl -XPUT 'localhost:9200/website/blog/123?pretty' -d'
	{
	  "title": "My first blog entry",
	  "text":  "I am starting to get the hang of this...",
	  "date":  "2014/01/02"
	}'
	# response will increment version #

# creating a new document
to make sure we are creating a new document and not updating, let ES generate the ID.
if we have our own id, then make sure index/type/id combination is unique.
1. use op_type querystring param:

	PUT /website/blog/123?op_type=create

2. PUT /website/blog/123/_create

409 Conflict if doc already exists with the same _index _type _id.

# deleting

curl -XDELETE 'localhost:9200/website/blog/123?pretty'

# optimistic concurrency

	1. get doc
	2. update using version
		-> 200K or 409 conflict if version is wrong
	curl -XGET 'localhost:9200/website/blog/1?pretty'
	curl -XPUT 'localhost:9200/website/blog/1?version=1 &pretty' -d'
	{
	  "title": "My first blog entry",
	  "text":  "Starting to get the hang of this..."
	}'

can also specify your own version number using:

	version_type=external

as long as the update has a higher version number, it will succeed.


# partial updates
curl -XPOST 'localhost:9200/website/blog/1/_update?pretty' -d'
{
   "doc" : {
      "tags" : [ "testing" ],
      "views": 0
   }
}'

# upserts

	curl -XPOST 'localhost:9200/website/pageviews/1/_update?pretty' -d'
	{
	   "script" : "ctx._source.views+=1",
	   "upsert": {
	       "views": 1
	   }
	}'

update conflicts can still occurr during the asych re-indexes processes.

You can retry which works if you are incrementing counters:

	curl -XPOST 'localhost:9200/website/pageviews/1/_update?retry_on_conflict=5 &pretty' -d'
	{
	   "script" : "ctx._source.views+=1",
	   "upsert": {
	       "views": 0
	   }
	}'

update API adopts last-write-wins by default

# multi doc retrieval

	curl -XGET 'localhost:9200/_mget?pretty' -d'
	{
	   "docs" : [
	      {
	         "_index" : "website",
	         "_type" :  "blog",
	         "_id" :    2
	      },
	      {
	         "_index" : "website",
	         "_type" :  "pageviews",
	         "_id" :    1,
	         "_source": "views"
	      }
	   ]
	}'

# bulk changes
json \n seperated
actions can be create, index, update or delete

	e.g. { "delete": { "_index": "website", "_type": "blog", "_id": "123" }}

each request is processed seperately, it is not atomic

	



